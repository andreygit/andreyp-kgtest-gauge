/*! andreyp-kgtest-gauge 2015-04-30 */
var gauge=function(a){function b(a,b,c,d){var e=a,f=b,g=c,h=d,i=g>h?0:1;e>f&&(rc=f,f=e,e=rc);var j,k,l,m,n,o,p,q,r=[];j=f*Math.cos(g),k=f*Math.sin(g),l=f*Math.cos(h),m=f*Math.sin(h);var s=Math.abs(h-g)<=Math.PI?0:1;n=e*Math.cos(h),o=e*Math.sin(h),p=e*Math.cos(g),q=e*Math.sin(g);var t=Math.abs(g-h)<=Math.PI?0:1;return r.push("M",j,",",k),null!=l&&r.push("A",f,",",f," 0 ",s,",",i," ",l,",",m),r.push("L",n,",",o),null!=p&&r.push("A",e,",",e," 0 ",t,",",1-i," ",p,",",q),r.push("Z"),r.join("")}function c(a,b,c){var d,e,f,g,h=[];return d=a*Math.cos(c),e=a*Math.sin(c),f=b*Math.cos(c),g=b*Math.sin(c),h.push("M",d,",",e),h.push("L",f,",",g),h.join("")}function e(a,b){var c,d;return c=a*Math.cos(b),d=a*Math.sin(b),{x:c,y:d}}this.parent=a,this.gaugeValue=0,this.arrowLength=170,this.labelMargin=5,this.tickMargin=15,this.tickSize=5,this.startAngle=150,this.endAngle=390,this.gaugeThick=3,this.drawn=!1,this.data={colors:[4080,255],colorScales:[0,50],labels:["a","b","c"]},this.setOptions=function(a){return this.setGaugeRadius(a.gaugeRadius),this.setGaugeThick(a.gaugeThick),this.setArrowLength(a.arrowLength),this.setStartAngle(a.startAngle),this.setEndAngle(a.endAngle),this.setTickSize(a.tickSize),this.setTickMargin(a.tickMargin),this.setLabelMargin(a.labelMargin),this.setColorScales(a.colorScales),this.setColorValues(a.colorValues),this.setLabels(a.labels),this.setValue(a.gaugeValue),this},this.setColorScales=function(a){this.data.colorScales=[];for(i in a)this.data.colorScales.push(a[i]/100);return this},this.setColorValues=function(a){this.data.colors=[];for(i in a)this.data.colors.push(a[i]);return this},this.setLabels=function(a){this.data.labels=[];for(i in a)this.data.labels.push(a[i]);return this},this.setValue=function(a){return this.gaugeValue=a/100,null!=this.arrow&&this.arrow.setAttribute("transform","rotate("+(this.startAngle+(this.endAngle-this.startAngle)*this.gaugeValue)+")"),this},this.setGaugeRadius=function(a){return this.gaugeRadius=a,this},this.setTickSize=function(a){return this.tickSize=a,this},this.setLabelMargin=function(a){return this.labelMargin=a,this},this.setTickMargin=function(a){return this.tickMargin=a,this},this.setStartAngle=function(a){return this.startAngle=a,this},this.setEndAngle=function(a){return this.endAngle=a,this},this.setArrowLength=function(a){return this.arrowLength=a,this},this.setGaugeThick=function(a){return this.gaugeThick=a,this},this.render=function(){var a=Math.PI/180,f="http://www.w3.org/2000/svg",g=document.createElementNS(f,"svg");g.setAttributeNS(null,"class","gauge");var h=document.createElementNS(f,"g");for(this.parent.appendChild(g),arrowThick=5,arrowBaseRad=10,g.appendChild(h),angleFrom=this.startAngle*a,angleTo=this.endAngle*a,width=300,height=300,len=angleTo-angleFrom,k=this.data.colorScales.length/len,i=1;i<this.data.colorScales.length;i++)d=b(this.gaugeRadius-this.gaugeThick,this.gaugeRadius,angleFrom+len*this.data.colorScales[i-1],angleFrom+len*this.data.colorScales[i]),arc1=document.createElementNS(f,"path"),arc1.setAttribute("d",d),arc1.style.fill=this.data.colors[i-1],h.appendChild(arc1);for(total=this.data.labels.length-1,k=(total+1)/len,i=0;i<this.data.labels.length;i++){angle=angleFrom+len*(i/total),d=c(this.gaugeRadius+this.tickMargin,this.gaugeRadius+this.tickMargin+this.tickSize,angle),line2=document.createElementNS(f,"path"),line2.setAttribute("d",d),line2.setAttribute("class","gauge-tick"),h.appendChild(line2),_tickText=e(this.gaugeRadius+this.tickMargin+this.tickSize,angleFrom+len*(i/total)),text2=document.createElementNS(f,"text"),text2.setAttribute("d",d),text2.setAttribute("x",_tickText.x),text2.setAttribute("y",_tickText.y),text2.textContent=this.data.labels[i],text2.setAttribute("class","gauge-label"),h.appendChild(text2);var j=text2.getComputedTextLength(),l=text2.getBBox().height;_tickText=e(this.gaugeRadius+this.tickMargin+this.labelMargin+this.tickSize,angleFrom+len*(i/total)),delta=10*a,this.tickSize>0?(text2.setAttribute("x",_tickText.x-j/2+j/2*Math.cos(angle)),text2.setAttribute("y",_tickText.y+l*(1+Math.sin(angle))/4)):(text2.setAttribute("x",_tickText.x-j/2-j/2*Math.cos(angle)),text2.setAttribute("y",_tickText.y-l*Math.sin(angle)))}return cir=document.createElementNS(f,"circle"),cir.setAttribute("cx","0"),cir.setAttribute("cy","0"),cir.setAttribute("r",arrowBaseRad),cir.setAttribute("class","gauge-arrow"),h.appendChild(cir),arrow=this.arrow=document.createElementNS(f,"path"),arrow.setAttribute("d","M0,"+arrowThick+"L"+this.arrowLength+",0L0,-"+arrowThick),arrow.setAttribute("class","gauge-arrow"),arrow.setAttribute("transform","rotate("+(this.startAngle+(this.endAngle-this.startAngle)*this.gaugeValue)+")"),h.appendChild(arrow),rect=h.getBBox(),svgRect=g.getBBox(),cw=g.clientWidth||g.getBoundingClientRect().width,ch=g.clientHeight||g.getBoundingClientRect().height,h.setAttribute("transform","translate("+(cw/2-rect.x-rect.width/2)+","+(ch/2-rect.y-rect.height/2)+")"),this.drawn=!0,this}};!function(a){a.fn.jqgauge=function(b){var c=this;return this.defaults={gaugeRadius:180,gaugeThick:3,arrowLength:175,startAngle:150,endAngle:390,tickSize:5,tickMargin:5,labelMargin:5,colorScales:[0,70,90,100],colorValues:["#666666","#ffa500","#ff0000"],labels:["0","1","2","3","4","5","6","7","8","9","10"],gaugeValue:100},this.settings=a.extend({},this.defaults,b),this.each(function(){this.instance=new gauge(this).setOptions(c.settings).render()}),this},a.fn.setValue=function(b){var c=this;return c.settings.gaugeValue=b/100,this.each(function(){a(this).find(".gauge-arrow").attr("transform","rotate("+(c.settings.startAngle+(c.settings.endAngle-c.settings.startAngle)*c.settings.gaugeValue)+")")}),this}}(jQuery);